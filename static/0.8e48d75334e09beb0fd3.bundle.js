webpackJsonp([0],{1813:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_objectWithoutProperties__=__webpack_require__(42),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_objectWithoutProperties___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_objectWithoutProperties__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of__=__webpack_require__(9),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__=__webpack_require__(4),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass__),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn__=__webpack_require__(7),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn__),__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_inherits__=__webpack_require__(8),__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_inherits___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_inherits__),__WEBPACK_IMPORTED_MODULE_7_react__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_7_react___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_7_react__),__WEBPACK_IMPORTED_MODULE_8_prop_types__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_8_prop_types___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_8_prop_types__),__WEBPACK_IMPORTED_MODULE_9_redux__=__webpack_require__(281),__WEBPACK_IMPORTED_MODULE_10_react_intl__=__webpack_require__(92),__WEBPACK_IMPORTED_MODULE_11__deskpro_portal_components__=__webpack_require__(670),__WEBPACK_IMPORTED_MODULE_12_lodash_omitBy__=(__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_11__deskpro_portal_components__),__webpack_require__(1814)),__WEBPACK_IMPORTED_MODULE_12_lodash_omitBy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_12_lodash_omitBy__),__WEBPACK_IMPORTED_MODULE_13_lodash_isEmpty__=__webpack_require__(1817),__WEBPACK_IMPORTED_MODULE_13_lodash_isEmpty___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_13_lodash_isEmpty__),__WEBPACK_IMPORTED_MODULE_14__form_Button__=__webpack_require__(184),__WEBPACK_IMPORTED_MODULE_15__utils_translateFieldLayout__=__webpack_require__(942),ChatEnterForm=function(_PureComponent){function ChatEnterForm(){return __WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_classCallCheck___default()(this,ChatEnterForm),__WEBPACK_IMPORTED_MODULE_5_babel_runtime_helpers_possibleConstructorReturn___default()(this,(ChatEnterForm.__proto__||__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_prototype_of___default()(ChatEnterForm)).apply(this,arguments))}return __WEBPACK_IMPORTED_MODULE_6_babel_runtime_helpers_inherits___default()(ChatEnterForm,_PureComponent),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_createClass___default()(ChatEnterForm,[{key:"render",value:function render(){return __WEBPACK_IMPORTED_MODULE_7_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_11__deskpro_portal_components__.Form,null,__WEBPACK_IMPORTED_MODULE_7_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_11__deskpro_portal_components__.FieldLayout,this.props),__WEBPACK_IMPORTED_MODULE_7_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_14__form_Button__.a,{width:"full",size:"medium",color:"primary",type:"submit"},__WEBPACK_IMPORTED_MODULE_7_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_10_react_intl__.a,{id:"chat.enter_form.button",defaultMessage:"Start Conversation"})))}}]),ChatEnterForm}(__WEBPACK_IMPORTED_MODULE_7_react__.PureComponent);ChatEnterForm.propTypes={intl:__WEBPACK_IMPORTED_MODULE_8_prop_types___default.a.object.isRequired};var formEnhancer=Object(__WEBPACK_IMPORTED_MODULE_11__deskpro_portal_components__.withFormik)({enableReinitialize:!0,mapPropsToValues:function mapPropsToValues(_ref){var category=_ref.category,layouts=_ref.layouts,user=_ref.user,layout=layouts.getMatchingLayout({category:category}),userData=__WEBPACK_IMPORTED_MODULE_12_lodash_omitBy___default()(user,__WEBPACK_IMPORTED_MODULE_13_lodash_isEmpty___default.a);return layout?__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default()({category:category},layout.getDefaultValues(),userData):__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default()({category:category},userData)},handleSubmit:function handleSubmit(values,_ref2){var props=_ref2.props;_ref2.setSubmitting;props.onSubmit(values)}});__webpack_exports__.a=Object(__WEBPACK_IMPORTED_MODULE_9_redux__.d)(__WEBPACK_IMPORTED_MODULE_10_react_intl__.d,function mapProps(WrappedComponent){return function(_ref3){var formConfig=_ref3.formConfig,props=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_helpers_objectWithoutProperties___default()(_ref3,["formConfig"]);return __WEBPACK_IMPORTED_MODULE_7_react___default.a.createElement(WrappedComponent,__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_extends___default()({},props,{layouts:new __WEBPACK_IMPORTED_MODULE_11__deskpro_portal_components__.LayoutConfig(Object(__WEBPACK_IMPORTED_MODULE_15__utils_translateFieldLayout__.a)(formConfig,props.intl.formatMessage))}))}},formEnhancer)(ChatEnterForm),ChatEnterForm.__docgenInfo={description:"",displayName:"ChatEnterForm",props:{intl:{type:{name:"object"},required:!0,description:""}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/chat/ChatEnterForm.jsx"]={name:"ChatEnterForm",docgenInfo:ChatEnterForm.__docgenInfo,path:"src/components/chat/ChatEnterForm.jsx"})},1814:function(module,exports,__webpack_require__){var baseIteratee=__webpack_require__(185),negate=__webpack_require__(1815),pickBy=__webpack_require__(1816);module.exports=function omitBy(object,predicate){return pickBy(object,negate(baseIteratee(predicate)))}},1815:function(module,exports){var FUNC_ERROR_TEXT="Expected a function";module.exports=function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}},1816:function(module,exports,__webpack_require__){var arrayMap=__webpack_require__(187),baseIteratee=__webpack_require__(185),basePickBy=__webpack_require__(943),getAllKeysIn=__webpack_require__(671);module.exports=function pickBy(object,predicate){if(null==object)return{};var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});return predicate=baseIteratee(predicate),basePickBy(object,props,function(value,path){return predicate(value,path[0])})}},1817:function(module,exports,__webpack_require__){var baseKeys=__webpack_require__(322),getTag=__webpack_require__(190),isArguments=__webpack_require__(123),isArray=__webpack_require__(21),isArrayLike=__webpack_require__(73),isBuffer=__webpack_require__(137),isPrototype=__webpack_require__(138),isTypedArray=__webpack_require__(188),mapTag="[object Map]",setTag="[object Set]",hasOwnProperty=Object.prototype.hasOwnProperty;module.exports=function isEmpty(value){if(null==value)return!0;if(isArrayLike(value)&&(isArray(value)||"string"==typeof value||"function"==typeof value.splice||isBuffer(value)||isTypedArray(value)||isArguments(value)))return!value.length;var tag=getTag(value);if(tag==mapTag||tag==setTag)return!value.size;if(isPrototype(value))return!baseKeys(value).length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}},671:function(module,exports,__webpack_require__){var baseGetAllKeys=__webpack_require__(282),getSymbolsIn=__webpack_require__(672),keysIn=__webpack_require__(192);module.exports=function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}},672:function(module,exports,__webpack_require__){var arrayPush=__webpack_require__(189),getPrototype=__webpack_require__(191),getSymbols=__webpack_require__(205),stubArray=__webpack_require__(283),getSymbolsIn=Object.getOwnPropertySymbols?function(object){for(var result=[];object;)arrayPush(result,getSymbols(object)),object=getPrototype(object);return result}:stubArray;module.exports=getSymbolsIn},939:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__=__webpack_require__(9),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__=__webpack_require__(4),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck__),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass__),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__=__webpack_require__(7),__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn__),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__=__webpack_require__(8),__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits__),__WEBPACK_IMPORTED_MODULE_5_react__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_5_react___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_react__),__WEBPACK_IMPORTED_MODULE_6_prop_types__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_6_prop_types___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_prop_types__),__WEBPACK_IMPORTED_MODULE_7_react_redux__=__webpack_require__(321),__WEBPACK_IMPORTED_MODULE_8_redux__=__webpack_require__(281),__WEBPACK_IMPORTED_MODULE_9_react_intl__=__webpack_require__(92),__WEBPACK_IMPORTED_MODULE_10__components_chat_Chat__=__webpack_require__(940),__WEBPACK_IMPORTED_MODULE_11__components_chat_ChatEnterForm__=__webpack_require__(1813),__WEBPACK_IMPORTED_MODULE_12__components_core_Block__=__webpack_require__(937),__WEBPACK_IMPORTED_MODULE_13__modules_chat__=__webpack_require__(323),__WEBPACK_IMPORTED_MODULE_14__modules_guest__=__webpack_require__(673),ChatScreen=function(_PureComponent){function ChatScreen(){var _ref,_temp,_this,_ret;__WEBPACK_IMPORTED_MODULE_1_babel_runtime_helpers_classCallCheck___default()(this,ChatScreen);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return _temp=_this=__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default()(this,(_ref=ChatScreen.__proto__||__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_get_prototype_of___default()(ChatScreen)).call.apply(_ref,[this].concat(args))),_this.state={viewMode:!_this.props.activeChat&&_this.props.preChatForm.length?"form":"chat",messages:[]},_this.handleSendMessage=function(message){var _this$props=_this.props,activeChat=_this$props.activeChat,category=_this$props.category;if(message){var messageModel="string"==typeof message?{message:message,origin:"user",type:"chat.message"}:message;activeChat?_this.props.sendMessage(messageModel):(_this.setState(function(_ref2){return{messages:_ref2.messages.concat([messageModel])}}),_this.props.preChatForm.length||_this.state.messages.length||_this.props.createChat({category:category}))}},_this.submitPreChatForm=function(formValues){_this.props.createChat(formValues),_this.setState({viewMode:"chat"})},_ret=_temp,__WEBPACK_IMPORTED_MODULE_3_babel_runtime_helpers_possibleConstructorReturn___default()(_this,_ret)}return __WEBPACK_IMPORTED_MODULE_4_babel_runtime_helpers_inherits___default()(ChatScreen,_PureComponent),__WEBPACK_IMPORTED_MODULE_2_babel_runtime_helpers_createClass___default()(ChatScreen,[{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){var _props=this.props,activeChat=_props.activeChat,sendMessage=_props.sendMessage,category=_props.category,isUnanswered=_props.isUnanswered;if(!prevProps.activeChat&&activeChat?(this.state.messages.forEach(function(message){return sendMessage(message,category)}),this.setState({messages:[]})):prevProps.activeChat&&!activeChat&&this.setState({viewMode:this.props.preChatForm.length?"form":"chat"}),!prevProps.isUnanswered&&isUnanswered)switch(this.props.noAnswerBehavior){case"save_ticket":this.props.showSaveTicketForm({category:category,formConfig:this.props.ticketFormConfig,chatId:activeChat});break;case"new_ticket":this.props.showCreateTicket({category:category,chatId:activeChat})}}},{key:"render",value:function render(){var _props2=this.props,category=_props2.category,preChatForm=_props2.preChatForm,prompt=_props2.prompt,activeChat=_props2.activeChat,intl=_props2.intl,user=_props2.user,viewMode=this.state.viewMode,capCategory=category[0].toUpperCase()+category.substring(1);return __WEBPACK_IMPORTED_MODULE_5_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_12__components_core_Block__.a,{title:intl.formatMessage({id:"chat.header."+category+"_title",defaultMessage:"{category} conversation"},{category:capCategory})},"form"===viewMode&&__WEBPACK_IMPORTED_MODULE_5_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_11__components_chat_ChatEnterForm__.a,{user:user,category:category,onSubmit:this.submitPreChatForm,formConfig:preChatForm}),"chat"===viewMode&&__WEBPACK_IMPORTED_MODULE_5_react___default.a.createElement(__WEBPACK_IMPORTED_MODULE_10__components_chat_Chat__.a,{messages:activeChat?this.props.messages:this.state.messages,category:this.props.category,onSendMessage:this.handleSendMessage,typing:this.props.typing,chatId:activeChat,prompt:prompt,user:user}))}}]),ChatScreen}(__WEBPACK_IMPORTED_MODULE_5_react__.PureComponent);ChatScreen.propTypes={user:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.object,activeChat:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.string,messages:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.array,typing:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.object,preChatForm:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.array,prompt:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.string,isUnanswered:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.bool,noAnswerBehavior:__WEBPACK_IMPORTED_MODULE_6_prop_types___default.a.oneOf(["save_ticket","new_ticket"])},ChatScreen.defaultProps={activeChat:null,messages:[],typing:null,preChatForm:[],prompt:"",isUnanswered:!1,noAnswerBehavior:null};__webpack_exports__.default=Object(__WEBPACK_IMPORTED_MODULE_8_redux__.d)(Object(__WEBPACK_IMPORTED_MODULE_7_react_redux__.b)(function mapStateToProps(state,props){return{user:Object(__WEBPACK_IMPORTED_MODULE_14__modules_guest__.b)(state),activeChat:Object(__WEBPACK_IMPORTED_MODULE_13__modules_chat__.d)(state,props),messages:Object(__WEBPACK_IMPORTED_MODULE_13__modules_chat__.e)(state,props),typing:Object(__WEBPACK_IMPORTED_MODULE_13__modules_chat__.f)(state,props),isUnanswered:Object(__WEBPACK_IMPORTED_MODULE_13__modules_chat__.h)(state,props)}},{createChat:__WEBPACK_IMPORTED_MODULE_13__modules_chat__.b,sendMessage:__WEBPACK_IMPORTED_MODULE_13__modules_chat__.i,showSaveTicketForm:__WEBPACK_IMPORTED_MODULE_13__modules_chat__.k,showCreateTicket:__WEBPACK_IMPORTED_MODULE_13__modules_chat__.j}),__WEBPACK_IMPORTED_MODULE_9_react_intl__.d)(ChatScreen),ChatScreen.__docgenInfo={description:"",displayName:"ChatScreen",props:{user:{type:{name:"object"},required:!1,description:""},activeChat:{type:{name:"string"},required:!1,description:"",defaultValue:{value:"null",computed:!1}},messages:{type:{name:"array"},required:!1,description:"",defaultValue:{value:"[]",computed:!1}},typing:{type:{name:"object"},required:!1,description:"",defaultValue:{value:"null",computed:!1}},preChatForm:{type:{name:"array"},required:!1,description:"",defaultValue:{value:"[]",computed:!1}},prompt:{type:{name:"string"},required:!1,description:"",defaultValue:{value:"''",computed:!1}},isUnanswered:{type:{name:"bool"},required:!1,description:"",defaultValue:{value:"false",computed:!1}},noAnswerBehavior:{type:{name:"enum",value:[{value:"'save_ticket'",computed:!1},{value:"'new_ticket'",computed:!1}]},required:!1,description:"",defaultValue:{value:"null",computed:!1}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/screens/ChatScreen.jsx"]={name:"ChatScreen",docgenInfo:ChatScreen.__docgenInfo,path:"src/screens/ChatScreen.jsx"})}});